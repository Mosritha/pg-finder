<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - View Users</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
   <link href="./style.css" rel="stylesheet">
</head>
<body>

    <!-- Navigation Bar -->
    <div class="header">
        <div class="roomroute">RoomRoute</div> <!-- RoomRoute Text -->
        <div class="button-container">
            <div class="menu-container">
                <div class="menu-icon" onclick="toggleMenu()">â˜°</div>
                <div class="menu-items" id="menu">
                    <a href="./user.html"><button>User Details</button></a>
                    <a href="./owner.html"><button>Property Owner details</button></a>
                    <a href="./adminproperty.html"><button>Available Properties</button></a>
                    <a href="./requests.html"><button>Requests</button></a>
                    <a href="./adminaddprop.html"><button>Add Property</button></a>
                    <a href="./main.html"><button>Go to Website</button></a>   
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h3 class="mb-0">Registered Owners</h3>
            </div>
            <div class="card-body">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Full Name</th>
                            <th>Email</th>
                            <th>Phone Number</th>
                            <th>Registration Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="userTable">
                        <!-- User data will be dynamically populated here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
   
    <script>
        // Function to load owners data from the backend
        function loadOwners() {
            fetch('http://localhost:3000/owner/')  // Update this URL if your API path changes
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log(data); // Check if data is returned correctly
                    const ownerTable = document.getElementById("userTable");
                    if (data.owner && data.owner.length > 0) {
                        data.owner.forEach(owner => {
                            const row = document.createElement("tr");
                            row.innerHTML = `
                                <td>${owner.s_no}</td>
                                <td>${owner.full_name}</td>
                                <td>${owner.email}</td>
                                <td>${owner.phone_no}</td>
                                <td>${new Date(owner.registration_date).toLocaleDateString()}</td>
                                <td>
                                    
                                    <button class="btn btn-danger btn-sm" onclick="deleteOwner('${owner._id}')">Delete</button>
                                </td>
                            `;
                            ownerTable.appendChild(row);
                        });
                    } else {
                        console.log('No owners found.');
                    }
                })
                .catch(error => {
                    console.error('Error fetching owners:', error);
                });
        }

        // Delete an owner
        function deleteOwner(id) {
            if (confirm('Are you sure you want to delete this owner?')) {
                fetch(`http://localhost:3000/owner/${id}`, {
                    method: 'DELETE',
                })
                .then(response => response.json())
                .then(data => {
                    alert('Owner deleted successfully');
                    // Remove the deleted row from the table
                    const row = document.getElementById(id);
                    row.remove();
                })
                .catch(error => {
                    console.error('Error deleting owner:', error);
                });
            }
        }

        // Edit an owner
        function editOwner(id) {
            // Redirect to a page or open a modal to edit the owner details
            window.location.href = `./edit-owner.html?id=${id}`; // This redirects to an edit page (e.g., edit-owner.html) with the owner ID in the query params
        }

        // Load owners when the page loads
        window.onload = loadOwners;
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function toggleMenu() {
            const menu = document.getElementById('menu');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        }
    </script>  

   
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG"></script>
</body>
</html>
